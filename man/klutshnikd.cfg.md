# NAME

klutshnikd.cfg - Configuration for the Klutshnik KMS server `klutshnikd`

# DESCRIPTION

`klutshnikd.cfg` defines the configuration settings for the Klutshnik
Key Management System (KMS) server/daemon.

The server searches for configuration files in the following order:

- `/etc/klutshnikd/config`
- `~/.config/klutshnikd/config`
- `~/.klutshnikdrc`
- `./klutshnikd.cfg`

The configuration file format is TOML.

## `[server]` SECTION

This section contains all the settings for the server.

### ADDRESS

The IPv4 or IPv6 address to listen on. Default: `127.0.0.1`.

### PORT

The port number the server is listening on. For production servers
accessible over the internet, port 443 is recommended to maximize
compatibility with restrictive firewalls. Default: `443`.

### `SSL_KEY` & `SSL_CERT`

Paths to the PEM-encoded TLS private key and certificate. These are
required for secure communication.

For production, it is recommended to use certificates from a trusted
Certificate Authority (CA) such as Let's Encrypt. If you have a domain name,
you can generate one using tools like `certbot`:

```sh
sudo certbot certonly --standalone --preferred-challenges http -d yourdomain.com
```

Self-signed certificates should only be used in development or
isolated VPN environments.

### TIMEOUT

The period in seconds after which the server will close an inactive
connection. This should be kept low to mitigate resource exhaustion
attacks while remaining long enough for legitimate clients to complete
requests. Default: 3s.

### DATADIR

The path to the directory where key-related data is stored. This
directory should be backed up securely. Default: `/var/lib/klutshnikd`.

### `MAX_KIDS`

The maximum number of handlers (sessions) to run in
parallel.
Adjust this based on expected load and available system resources.
Default: 5.

### VERBOSE

A boolean value that enables detailed logging of server operations to standard output.

### `RECORD_SALT`

A unique salt used to internally hash record IDs provided by
clients. It should be initialized to a unique random value
upon installation.

### `TS_EPSILON`

The maximum age in seconds for a Distributed Key Generation (DKG)
protocol message to be considered valid. Higher values can support
higher network latency but may increase the window for certain replay
attacks. Default: 600s.

### LTSIGKEY

The path to a file containing the server's long-term signing key.
This key defines the server's identity and is used to sign protocol messages.
The key can be generated by running the `klutshnikd(8)`
client with the `init` parameter:

```sh
klutshnikd init
```

### NOISEKEY

The path to the server's long-term Noise private key, used for secure
authenticated key exchange. The key can be generated by running the `klutshnikd(8)`
client with the `init` parameter:

```sh
$ klutshnikd init
```

You need to publish this so that users can use your server.

### AUTHORIZED_KEYS

The path to a file containing a list of long-term signing public
keys from other key management servers. This is checked on create and
key-rotation operations, when the servers are establishing contact
with each other.

# SECURITY CONSIDERATIONS

You **SHOULD** back up your configuration, especially your `LTSIGKEY`,
`NOISEKEY`, `SSL_CERT`, `SSL_KEY`, and `RECORD_SALT` settings.

# REPORTING BUGS

https://github.com/stef/klutshnik/issues/

# AUTHOR

Written by Stefan Marsiske.

# COPYRIGHT

Copyright Â© 2024 Stefan Marsiske. License GPLv3+: GNU GPL version 3 or later <https://gnu.org/licenses/gpl.html>.
This is free software: you are free to change and redistribute it. There is NO WARRANTY, to the extent permitted by law.

# SEE ALSO

`klutshnikd(8)`, `klutshnik(1)`, `klutshnik.cfg(5)`
